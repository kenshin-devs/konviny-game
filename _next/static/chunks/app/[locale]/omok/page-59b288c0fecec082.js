(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{128:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return o}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let a="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return a?new a:new r}function s(e){return a?a.bind(e):r.bind(e)}function o(){return a?a.snapshot():function(e,...t){return e(...t)}}},1253:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=n(3342)},1614:(e,t,n)=>{"use strict";n.d(t,{h:()=>j});var r,a,l=n(2946),s=["logic","gpt","gemini","claude"];function o(e){return s.includes(e)}var i=null!=(a=null==(r=l.env.NEXT_PUBLIC_MISC_BACKEND_URL)?void 0:r.replace(/\/$/,""))?a:"http://localhost:4000";async function u(e){let t=await e.json().catch(()=>null);if(!e.ok){let e="object"==typeof t&&t&&"message"in t?t.message:"Request failed";throw Error(null!=e?e:"Request failed")}return t}async function c(e){var t;return u(await fetch("".concat(i,"/api/v1/omok/ai-move"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({board:e.board,provider:e.provider,aiStone:e.aiStone,playerStone:e.playerStone,timeoutMs:e.timeoutMs,mode:null!=(t=e.mode)?t:"ai"})})).then(e=>e.decision)}var d=[[1,0],[0,1],[1,1],[1,-1]];function m(e,t){return e>=0&&e<15&&t>=0&&t<15}function f(e,t,n,r,a,l){var s;let o=t+r,i=n+a,u=0;for(;m(o,i)&&(null==(s=e[i])?void 0:s[o])===l;)u+=1,o+=r,i+=a;return u}function b(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=null!=(e=n.playerStone)?e:"black",a=null!=(t=n.aiStone)?t:"white";return{board:Array.from({length:15},()=>Array.from({length:15},()=>null)),playerStone:r,aiStone:a,turn:"black",status:"black"===r?"player_turn":"ai_turn",winner:null,moveCount:0,lastMove:null}}function x(e,t){var n,r,a,l,s;if("finished"===e.status||t.stone!==e.turn||(n=e.board,!m(r=t.x,a=t.y)||(null==(l=n[a])?void 0:l[r])!==null))return e;let o=e.board.map(e=>[...e]),i=o[t.y];if(!i)return e;i[t.x]=t.stone;let u=!function(e,t){for(let[n,r]of d)if(1+f(e,t.x,t.y,n,r,t.stone)+f(e,t.x,t.y,-n,-r,t.stone)>=5)return!0;return!1}(o,t)?o.some(e=>e.some(e=>null===e))?null:"draw":t.stone,c="black"===t.stone?"white":"black";return{...e,board:o,turn:c,status:(s=e.playerStone,u?"finished":c===s?"player_turn":"ai_turn"),winner:u,moveCount:e.moveCount+1,lastMove:t}}var p=n(9401),h=n(8765),y=n(2946),g={logic:"Logic",gpt:"GPT",gemini:"Gemini",claude:"Claude"},v=y.env.NEXT_PUBLIC_OMOK_AI_PROVIDER;function j(e){let{locale:t}=e,[n,r]=(0,p.useState)(()=>"string"==typeof v&&o(v)?v:"logic"),[a,l]=(0,p.useState)(()=>b({playerStone:"black",aiStone:"white"})),[i,u]=(0,p.useState)(!1),[d,m]=(0,p.useState)(null),[f,y]=(0,p.useState)(null),[j,_]=(0,p.useState)(null),S=(0,p.useRef)(0),w=(0,p.useMemo)(()=>{if("finished"===a.status){var e,t;return e=a.winner,t=a.playerStone,"draw"===e?"무승부입니다.":e?e===t?"승리했습니다.":"AI가 승리했습니다.":""}return i?"".concat(g[n]," 엔진이 수를 계산 중입니다..."):"player_turn"===a.status?"당신의 차례입니다.":"AI 차례입니다."},[a.playerStone,a.status,a.winner,n,i]),k=(0,p.useCallback)(async(e,t,n)=>{u(!0);try{let r=await c({board:e.board,aiStone:e.aiStone,playerStone:e.playerStone,provider:t,mode:"ai"});if(S.current!==n)return;l(e=>{var t;return t=r.move,x(e,{x:t.x,y:t.y,stone:e.aiStone})}),_({x:r.move.x,y:r.move.y}),r.fallbackUsed&&y("".concat(g[t]," 호출에 실패해 Logic으로 폴백했습니다.")),m("".concat(g[r.providerUsed],"가 (").concat(r.move.x,", ").concat(r.move.y,")에 착수했습니다."))}catch(e){if(S.current!==n)return;y(e instanceof Error?e.message:"AI move request failed")}finally{S.current===n&&u(!1)}},[]),N=(0,p.useCallback)((e,t)=>{if(i||"player_turn"!==a.status)return;let r=x(a,{x:e,y:t,stone:a.playerStone});if(r===a||(l(r),m(null),y(null),"ai_turn"!==r.status))return;let s=S.current+1;S.current=s,k(r,n,s)},[a,n,k,i]),O=(0,p.useCallback)(()=>{S.current+=1,u(!1),m(null),y(null),_(null),l(e=>b({playerStone:e.playerStone,aiStone:e.aiStone}))},[]);return(0,h.jsx)("main",{className:"min-h-screen bg-[linear-gradient(180deg,#f8fafc_0%,#e2e8f0_100%)] p-4 text-slate-900 sm:p-8",children:(0,h.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 lg:flex-row",children:[(0,h.jsxs)("section",{className:"flex-1 rounded-2xl border border-amber-500/30 bg-amber-100/60 p-4 shadow-xl backdrop-blur",children:[(0,h.jsxs)("header",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl font-bold sm:text-3xl",children:"Omok AI Arena"}),(0,h.jsx)("p",{className:"text-sm text-slate-700",children:"즉시 대국 + 교체 가능한 AI 엔진"})]}),(0,h.jsx)("button",{type:"button","data-testid":"omok-restart",onClick:O,className:"rounded-md bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100",children:"재시작"})]}),(0,h.jsx)("div",{className:"overflow-x-auto rounded-xl border border-amber-700/40 bg-amber-200/80 p-3",children:(0,h.jsx)("div",{"data-testid":"omok-board-grid",className:"mx-auto grid w-fit gap-[2px] rounded-md bg-amber-900/50 p-2",style:{gridTemplateColumns:"repeat(".concat(15,", minmax(0, 1fr))")},children:a.board.map((e,t)=>e.map((e,n)=>(0,h.jsx)("button",{type:"button","data-testid":"omok-cell-".concat(n,"-").concat(t),"data-stone":null!=e?e:"empty",onClick:()=>N(n,t),disabled:i||"player_turn"!==a.status||null!==e,className:"flex h-7 w-7 items-center justify-center bg-amber-300 text-[10px] transition hover:bg-amber-200 disabled:cursor-default sm:h-8 sm:w-8",children:e?(0,h.jsx)("span",{className:"h-5 w-5 rounded-full ".concat("black"===e?"bg-slate-950":"white"===e?"bg-slate-100 border border-slate-500":"")}):null},"".concat(n,"-").concat(t))))})})]}),(0,h.jsxs)("aside",{className:"w-full max-w-full space-y-4 lg:w-96",children:[(0,h.jsxs)("section",{className:"rounded-2xl border border-slate-300 bg-white p-4 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-lg font-semibold",children:"대국 상태"}),(0,h.jsx)("p",{"data-testid":"omok-status-message",className:"mt-2 text-sm text-slate-700",children:w}),(0,h.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:["locale: ",t.replace(/_/g,"-")]}),d?(0,h.jsx)("p",{className:"mt-2 text-sm text-cyan-700",children:d}):null,f?(0,h.jsx)("p",{"data-testid":"omok-fallback-message",className:"mt-2 text-sm text-rose-600",children:f}):null,(0,h.jsxs)("p",{"data-testid":"omok-last-ai-move",className:"mt-2 text-sm text-slate-700",children:["마지막 AI 수: ",j?"(".concat(j.x,", ").concat(j.y,")"):"-"]})]}),(0,h.jsxs)("section",{className:"rounded-2xl border border-slate-300 bg-white p-4 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-lg font-semibold",children:"AI 엔진"}),(0,h.jsxs)("label",{className:"mt-2 block text-sm",children:["Provider",(0,h.jsx)("select",{"data-testid":"omok-provider-select",value:n,onChange:e=>{let t=e.target.value;o(t)&&(r(t),y(null),m(null))},className:"mt-1 w-full rounded border border-slate-300 px-3 py-2",children:s.map(e=>(0,h.jsx)("option",{value:e,children:g[e]},e))})]}),(0,h.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:["env 기본값: ",(0,h.jsx)("code",{children:"NEXT_PUBLIC_OMOK_AI_PROVIDER"})," (미설정 시 logic)"]})]}),(0,h.jsxs)("section",{"data-testid":"omok-pvp-placeholder",className:"rounded-2xl border border-blue-300 bg-blue-50 p-4 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-lg font-semibold text-blue-900",children:"유저 대전 (예정)"}),(0,h.jsx)("p",{className:"mt-2 text-sm text-blue-800",children:"다음 단계에서 방 생성/턴 동기화/WebSocket authoritative 구조로 확장할 예정입니다."})]})]})]})})}},2292:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=n(8765),a=n(9401),l=n(6835);function s(e){return{default:e&&"default"in e?e.default:e}}n(3086);let o={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},i=function(e){let t={...o,...e},n=(0,a.lazy)(()=>t.loader().then(s)),i=t.loading;function u(e){let s=i?(0,r.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,u=o?a.Suspense:a.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(u,{...o?{fallback:s}:{},children:c})}return u.displayName="LoadableComponent",u}},3086:(e,t,n)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),n(8765),n(1052),n(1253),n(1068)},3342:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,n(128).createAsyncLocalStorage)()},3988:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let r=n(2664)._(n(2292));function a(e,t){var n;let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,r.default)({...l,modules:null==(n=l.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6835:(e,t,n)=>{"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(9719)},6847:(e,t,n)=>{"use strict";n.d(t,{default:()=>a.a});var r=n(3988),a=n.n(r)},8549:(e,t,n)=>{Promise.resolve().then(n.bind(n,9630))},9630:(e,t,n)=>{"use strict";n.d(t,{OmokPlayScreenDynamic:()=>l}),n(1614);var r=n(6847),a=n(8765),l=(0,r.default)(()=>n.e(377).then(n.bind(n,6377)).then(e=>e.OmokPlayScreen),{loadableGenerated:{webpack:()=>[require.resolveWeak("./OmokPlayScreen-HR6J3BBO.js")]},loading:()=>(0,a.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center bg-slate-100 text-slate-900",children:"Loading omok engine..."})})}},e=>{e.O(0,[769,359,358],()=>e(e.s=8549)),_N_E=e.O()}]);